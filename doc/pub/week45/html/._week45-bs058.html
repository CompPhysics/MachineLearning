<!--
HTML file automatically generated from DocOnce source
(https://github.com/doconce/doconce/)
doconce format html week45.do.txt --html_style=bootstrap --pygments_html_style=default --html_admon=bootstrap_panel --html_output=week45-bs --no_mako
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/doconce/doconce/" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="Week 45,  Convolutional Neural Networks (CCNs)">
<title>Week 45,  Convolutional Neural Networks (CCNs)</title>
<!-- Bootstrap style: bootstrap -->
<!-- doconce format html week45.do.txt --html_style=bootstrap --pygments_html_style=default --html_admon=bootstrap_panel --html_output=week45-bs --no_mako -->
<link href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
<!-- not necessary
<link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
-->
<style type="text/css">
/* Add scrollbar to dropdown menus in bootstrap navigation bar */
.dropdown-menu {
   height: auto;
   max-height: 400px;
   overflow-x: hidden;
}
/* Adds an invisible element before each target to offset for the navigation
   bar */
.anchor::before {
  content:"";
  display:block;
  height:50px;      /* fixed header height for style bootstrap */
  margin:-50px 0 0; /* negative fixed header height */
}
</style>
</head>

<!-- tocinfo
{'highest level': 2,
 'sections': [('Plans for week 45', 2, None, 'plans-for-week-45'),
              ('Material for the lab sessions',
               2,
               None,
               'material-for-the-lab-sessions'),
              ('Material for Lecture Monday November 3',
               2,
               None,
               'material-for-lecture-monday-november-3'),
              ('Convolutional Neural Networks (recognizing images), reminder '
               'from last week',
               2,
               None,
               'convolutional-neural-networks-recognizing-images-reminder-from-last-week'),
              ('What is the Difference', 2, None, 'what-is-the-difference'),
              ('Neural Networks vs CNNs', 2, None, 'neural-networks-vs-cnns'),
              ('Why CNNS for images, sound files, medical images from CT scans '
               'etc?',
               2,
               None,
               'why-cnns-for-images-sound-files-medical-images-from-ct-scans-etc'),
              ('Regular NNs don’t scale well to full images',
               2,
               None,
               'regular-nns-don-t-scale-well-to-full-images'),
              ('3D volumes of neurons', 2, None, '3d-volumes-of-neurons'),
              ('More on Dimensionalities', 2, None, 'more-on-dimensionalities'),
              ('Further remarks', 2, None, 'further-remarks'),
              ('Layers used to build CNNs',
               2,
               None,
               'layers-used-to-build-cnns'),
              ('Transforming images', 2, None, 'transforming-images'),
              ('CNNs in brief', 2, None, 'cnns-in-brief'),
              ('A deep CNN model ("From Raschka et '
               'al":"https://github.com/rasbt/machine-learning-book")',
               2,
               None,
               'a-deep-cnn-model-from-raschka-et-al-https-github-com-rasbt-machine-learning-book'),
              ('Key Idea', 2, None, 'key-idea'),
              ('Mathematics of CNNs', 2, None, 'mathematics-of-cnns'),
              ('Convolution Examples: Polynomial multiplication',
               2,
               None,
               'convolution-examples-polynomial-multiplication'),
              ('Efficient Polynomial Multiplication',
               2,
               None,
               'efficient-polynomial-multiplication'),
              ('Further simplification', 2, None, 'further-simplification'),
              ('A more efficient way of coding the above Convolution',
               2,
               None,
               'a-more-efficient-way-of-coding-the-above-convolution'),
              ('Commutative process', 2, None, 'commutative-process'),
              ('Toeplitz matrices', 2, None, 'toeplitz-matrices'),
              ('Fourier series and Toeplitz matrices',
               2,
               None,
               'fourier-series-and-toeplitz-matrices'),
              ('Generalizing the above one-dimensional case',
               2,
               None,
               'generalizing-the-above-one-dimensional-case'),
              ('Memory considerations', 2, None, 'memory-considerations'),
              ('Padding', 2, None, 'padding'),
              ('New vector', 2, None, 'new-vector'),
              ('Rewriting as dot products',
               2,
               None,
               'rewriting-as-dot-products'),
              ('Cross correlation', 2, None, 'cross-correlation'),
              ('Two-dimensional objects', 2, None, 'two-dimensional-objects'),
              ('CNNs in more detail, simple example',
               2,
               None,
               'cnns-in-more-detail-simple-example'),
              ('The convolution stage', 2, None, 'the-convolution-stage'),
              ('Finding the number of parameters',
               2,
               None,
               'finding-the-number-of-parameters'),
              ('New image (or volume)', 2, None, 'new-image-or-volume'),
              ('Parameters to train, common settings',
               2,
               None,
               'parameters-to-train-common-settings'),
              ('Examples of CNN setups', 2, None, 'examples-of-cnn-setups'),
              ('Summarizing: Performing a general discrete convolution ("From '
               'Raschka et '
               'al":"https://github.com/rasbt/machine-learning-book")',
               2,
               None,
               'summarizing-performing-a-general-discrete-convolution-from-raschka-et-al-https-github-com-rasbt-machine-learning-book'),
              ('Pooling', 2, None, 'pooling'),
              ('Pooling arithmetic', 2, None, 'pooling-arithmetic'),
              ('Pooling types ("From Raschka et '
               'al":"https://github.com/rasbt/machine-learning-book")',
               2,
               None,
               'pooling-types-from-raschka-et-al-https-github-com-rasbt-machine-learning-book'),
              ('Building convolutional neural networks using Tensorflow and '
               'Keras',
               2,
               None,
               'building-convolutional-neural-networks-using-tensorflow-and-keras'),
              ('Setting it up', 2, None, 'setting-it-up'),
              ('The MNIST dataset again', 2, None, 'the-mnist-dataset-again'),
              ('Strong correlations', 2, None, 'strong-correlations'),
              ('Layers of a CNN', 2, None, 'layers-of-a-cnn'),
              ('Systematic reduction', 2, None, 'systematic-reduction'),
              ('Prerequisites: Collect and pre-process data',
               2,
               None,
               'prerequisites-collect-and-pre-process-data'),
              ('Importing Keras and Tensorflow',
               2,
               None,
               'importing-keras-and-tensorflow'),
              ('Running with Keras', 2, None, 'running-with-keras'),
              ('Final part', 2, None, 'final-part'),
              ('Final visualization', 2, None, 'final-visualization'),
              ('The CIFAR01 data set', 2, None, 'the-cifar01-data-set'),
              ('Verifying the data set', 2, None, 'verifying-the-data-set'),
              ('Set up  the model', 2, None, 'set-up-the-model'),
              ('Add Dense layers on top', 2, None, 'add-dense-layers-on-top'),
              ('Compile and train the model',
               2,
               None,
               'compile-and-train-the-model'),
              ('Finally, evaluate the model',
               2,
               None,
               'finally-evaluate-the-model'),
              ('Building code using Pytorch',
               2,
               None,
               'building-code-using-pytorch')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript" async
 src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- Bootstrap navigation bar -->
<div class="navbar navbar-default navbar-fixed-top">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="week45-bs.html">Week 45,  Convolutional Neural Networks (CCNs)</a>
  </div>
  <div class="navbar-collapse collapse navbar-responsive-collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents <b class="caret"></b></a>
        <ul class="dropdown-menu">
     <!-- navigation toc: --> <li><a href="._week45-bs001.html#plans-for-week-45" style="font-size: 80%;">Plans for week 45</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs002.html#material-for-the-lab-sessions" style="font-size: 80%;">Material for the lab sessions</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs003.html#material-for-lecture-monday-november-3" style="font-size: 80%;">Material for Lecture Monday November 3</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs004.html#convolutional-neural-networks-recognizing-images-reminder-from-last-week" style="font-size: 80%;">Convolutional Neural Networks (recognizing images), reminder from last week</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs005.html#what-is-the-difference" style="font-size: 80%;">What is the Difference</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs006.html#neural-networks-vs-cnns" style="font-size: 80%;">Neural Networks vs CNNs</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs007.html#why-cnns-for-images-sound-files-medical-images-from-ct-scans-etc" style="font-size: 80%;">Why CNNS for images, sound files, medical images from CT scans etc?</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs008.html#regular-nns-don-t-scale-well-to-full-images" style="font-size: 80%;">Regular NNs don’t scale well to full images</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs009.html#3d-volumes-of-neurons" style="font-size: 80%;">3D volumes of neurons</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs010.html#more-on-dimensionalities" style="font-size: 80%;">More on Dimensionalities</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs011.html#further-remarks" style="font-size: 80%;">Further remarks</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs012.html#layers-used-to-build-cnns" style="font-size: 80%;">Layers used to build CNNs</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs013.html#transforming-images" style="font-size: 80%;">Transforming images</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs014.html#cnns-in-brief" style="font-size: 80%;">CNNs in brief</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs015.html#a-deep-cnn-model-from-raschka-et-al-https-github-com-rasbt-machine-learning-book" style="font-size: 80%;">A deep CNN model ("From Raschka et al":"https://github.com/rasbt/machine-learning-book")</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs016.html#key-idea" style="font-size: 80%;">Key Idea</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs017.html#mathematics-of-cnns" style="font-size: 80%;">Mathematics of CNNs</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs018.html#convolution-examples-polynomial-multiplication" style="font-size: 80%;">Convolution Examples: Polynomial multiplication</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs019.html#efficient-polynomial-multiplication" style="font-size: 80%;">Efficient Polynomial Multiplication</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs020.html#further-simplification" style="font-size: 80%;">Further simplification</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs021.html#a-more-efficient-way-of-coding-the-above-convolution" style="font-size: 80%;">A more efficient way of coding the above Convolution</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs022.html#commutative-process" style="font-size: 80%;">Commutative process</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs023.html#toeplitz-matrices" style="font-size: 80%;">Toeplitz matrices</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs024.html#fourier-series-and-toeplitz-matrices" style="font-size: 80%;">Fourier series and Toeplitz matrices</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs025.html#generalizing-the-above-one-dimensional-case" style="font-size: 80%;">Generalizing the above one-dimensional case</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs026.html#memory-considerations" style="font-size: 80%;">Memory considerations</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs027.html#padding" style="font-size: 80%;">Padding</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs028.html#new-vector" style="font-size: 80%;">New vector</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs029.html#rewriting-as-dot-products" style="font-size: 80%;">Rewriting as dot products</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs030.html#cross-correlation" style="font-size: 80%;">Cross correlation</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs030.html#two-dimensional-objects" style="font-size: 80%;">Two-dimensional objects</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs031.html#cnns-in-more-detail-simple-example" style="font-size: 80%;">CNNs in more detail, simple example</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs032.html#the-convolution-stage" style="font-size: 80%;">The convolution stage</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs033.html#finding-the-number-of-parameters" style="font-size: 80%;">Finding the number of parameters</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs034.html#new-image-or-volume" style="font-size: 80%;">New image (or volume)</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs035.html#parameters-to-train-common-settings" style="font-size: 80%;">Parameters to train, common settings</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs036.html#examples-of-cnn-setups" style="font-size: 80%;">Examples of CNN setups</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs037.html#summarizing-performing-a-general-discrete-convolution-from-raschka-et-al-https-github-com-rasbt-machine-learning-book" style="font-size: 80%;">Summarizing: Performing a general discrete convolution ("From Raschka et al":"https://github.com/rasbt/machine-learning-book")</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs038.html#pooling" style="font-size: 80%;">Pooling</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs039.html#pooling-arithmetic" style="font-size: 80%;">Pooling arithmetic</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs040.html#pooling-types-from-raschka-et-al-https-github-com-rasbt-machine-learning-book" style="font-size: 80%;">Pooling types ("From Raschka et al":"https://github.com/rasbt/machine-learning-book")</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs041.html#building-convolutional-neural-networks-using-tensorflow-and-keras" style="font-size: 80%;">Building convolutional neural networks using Tensorflow and Keras</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs042.html#setting-it-up" style="font-size: 80%;">Setting it up</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs043.html#the-mnist-dataset-again" style="font-size: 80%;">The MNIST dataset again</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs044.html#strong-correlations" style="font-size: 80%;">Strong correlations</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs045.html#layers-of-a-cnn" style="font-size: 80%;">Layers of a CNN</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs046.html#systematic-reduction" style="font-size: 80%;">Systematic reduction</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs047.html#prerequisites-collect-and-pre-process-data" style="font-size: 80%;">Prerequisites: Collect and pre-process data</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs048.html#importing-keras-and-tensorflow" style="font-size: 80%;">Importing Keras and Tensorflow</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs049.html#running-with-keras" style="font-size: 80%;">Running with Keras</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs050.html#final-part" style="font-size: 80%;">Final part</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs051.html#final-visualization" style="font-size: 80%;">Final visualization</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs052.html#the-cifar01-data-set" style="font-size: 80%;">The CIFAR01 data set</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs053.html#verifying-the-data-set" style="font-size: 80%;">Verifying the data set</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs054.html#set-up-the-model" style="font-size: 80%;">Set up  the model</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs055.html#add-dense-layers-on-top" style="font-size: 80%;">Add Dense layers on top</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs056.html#compile-and-train-the-model" style="font-size: 80%;">Compile and train the model</a></li>
     <!-- navigation toc: --> <li><a href="._week45-bs057.html#finally-evaluate-the-model" style="font-size: 80%;">Finally, evaluate the model</a></li>
     <!-- navigation toc: --> <li><a href="#building-code-using-pytorch" style="font-size: 80%;">Building code using Pytorch</a></li>

        </ul>
      </li>
    </ul>
  </div>
</div>
</div> <!-- end of navigation bar -->
<div class="container">
<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> <!-- add vertical space -->
<a name="part0058"></a>
<!-- !split -->
<h2 id="building-code-using-pytorch" class="anchor">Building code using Pytorch </h2>

<p>This code loads and normalizes the MNIST dataset. Thereafter it defines  a CNN architecture with:</p>
<ol>
<li> Two convolutional layers</li>
<li> Max pooling</li>
<li> Dropout for regularization</li>
<li> Two fully connected layers</li>
</ol>
<p>It uses the Adam optimizer and for cost function it employs the
Cross-Entropy function. It trains for 10 epochs.
You can modify the architecture (number of layers, channels, dropout
rate) or training parameters (learning rate, batch size, epochs) to
experiment with different configurations.
</p>


<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="inner_cell">
      <div class="input_area">
        <div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%;"><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">torch</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">torch.nn</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">nn</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">torch.nn.functional</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">F</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">torch.optim</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">optim</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">torchvision</span> <span style="color: #008000; font-weight: bold">import</span> datasets, transforms

<span style="color: #408080; font-style: italic"># Set device</span>
device <span style="color: #666666">=</span> torch<span style="color: #666666">.</span>device(<span style="color: #BA2121">&quot;cuda&quot;</span> <span style="color: #008000; font-weight: bold">if</span> torch<span style="color: #666666">.</span>cuda<span style="color: #666666">.</span>is_available() <span style="color: #008000; font-weight: bold">else</span> <span style="color: #BA2121">&quot;cpu&quot;</span>)

<span style="color: #408080; font-style: italic"># Define transforms</span>
transform <span style="color: #666666">=</span> transforms<span style="color: #666666">.</span>Compose([
   transforms<span style="color: #666666">.</span>ToTensor(),
   transforms<span style="color: #666666">.</span>Normalize((<span style="color: #666666">0.1307</span>,), (<span style="color: #666666">0.3081</span>,))
])

<span style="color: #408080; font-style: italic"># Load datasets</span>
train_dataset <span style="color: #666666">=</span> datasets<span style="color: #666666">.</span>MNIST(root<span style="color: #666666">=</span><span style="color: #BA2121">&#39;./data&#39;</span>, train<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">True</span>, download<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">True</span>, transform<span style="color: #666666">=</span>transform)
test_dataset <span style="color: #666666">=</span> datasets<span style="color: #666666">.</span>MNIST(root<span style="color: #666666">=</span><span style="color: #BA2121">&#39;./data&#39;</span>, train<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">False</span>, download<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">True</span>, transform<span style="color: #666666">=</span>transform)

<span style="color: #408080; font-style: italic"># Create data loaders</span>
train_loader <span style="color: #666666">=</span> torch<span style="color: #666666">.</span>utils<span style="color: #666666">.</span>data<span style="color: #666666">.</span>DataLoader(train_dataset, batch_size<span style="color: #666666">=64</span>, shuffle<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">True</span>)
test_loader <span style="color: #666666">=</span> torch<span style="color: #666666">.</span>utils<span style="color: #666666">.</span>data<span style="color: #666666">.</span>DataLoader(test_dataset, batch_size<span style="color: #666666">=64</span>, shuffle<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">False</span>)

<span style="color: #408080; font-style: italic"># Define CNN model</span>
<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">CNN</span>(nn<span style="color: #666666">.</span>Module):
   <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>):
       <span style="color: #008000">super</span>(CNN, <span style="color: #008000">self</span>)<span style="color: #666666">.</span><span style="color: #0000FF">__init__</span>()
       <span style="color: #008000">self</span><span style="color: #666666">.</span>conv1 <span style="color: #666666">=</span> nn<span style="color: #666666">.</span>Conv2d(<span style="color: #666666">1</span>, <span style="color: #666666">32</span>, <span style="color: #666666">3</span>, padding<span style="color: #666666">=1</span>)
       <span style="color: #008000">self</span><span style="color: #666666">.</span>conv2 <span style="color: #666666">=</span> nn<span style="color: #666666">.</span>Conv2d(<span style="color: #666666">32</span>, <span style="color: #666666">64</span>, <span style="color: #666666">3</span>, padding<span style="color: #666666">=1</span>)
       <span style="color: #008000">self</span><span style="color: #666666">.</span>pool <span style="color: #666666">=</span> nn<span style="color: #666666">.</span>MaxPool2d(<span style="color: #666666">2</span>, <span style="color: #666666">2</span>)
       <span style="color: #008000">self</span><span style="color: #666666">.</span>fc1 <span style="color: #666666">=</span> nn<span style="color: #666666">.</span>Linear(<span style="color: #666666">64*7*7</span>, <span style="color: #666666">1024</span>)
       <span style="color: #008000">self</span><span style="color: #666666">.</span>fc2 <span style="color: #666666">=</span> nn<span style="color: #666666">.</span>Linear(<span style="color: #666666">1024</span>, <span style="color: #666666">10</span>)
       <span style="color: #008000">self</span><span style="color: #666666">.</span>dropout <span style="color: #666666">=</span> nn<span style="color: #666666">.</span>Dropout(<span style="color: #666666">0.5</span>)

   <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">forward</span>(<span style="color: #008000">self</span>, x):
       x <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>pool(F<span style="color: #666666">.</span>relu(<span style="color: #008000">self</span><span style="color: #666666">.</span>conv1(x)))
       x <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>pool(F<span style="color: #666666">.</span>relu(<span style="color: #008000">self</span><span style="color: #666666">.</span>conv2(x)))
       x <span style="color: #666666">=</span> x<span style="color: #666666">.</span>view(<span style="color: #666666">-1</span>, <span style="color: #666666">64*7*7</span>)
       x <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>dropout(F<span style="color: #666666">.</span>relu(<span style="color: #008000">self</span><span style="color: #666666">.</span>fc1(x)))
       x <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>fc2(x)
       <span style="color: #008000; font-weight: bold">return</span> x

<span style="color: #408080; font-style: italic"># Initialize model, loss function, and optimizer</span>
model <span style="color: #666666">=</span> CNN()<span style="color: #666666">.</span>to(device)
criterion <span style="color: #666666">=</span> nn<span style="color: #666666">.</span>CrossEntropyLoss()
optimizer <span style="color: #666666">=</span> optim<span style="color: #666666">.</span>Adam(model<span style="color: #666666">.</span>parameters(), lr<span style="color: #666666">=0.001</span>)

<span style="color: #408080; font-style: italic"># Training loop</span>
num_epochs <span style="color: #666666">=</span> <span style="color: #666666">10</span>
<span style="color: #008000; font-weight: bold">for</span> epoch <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(num_epochs):
   model<span style="color: #666666">.</span>train()
   running_loss <span style="color: #666666">=</span> <span style="color: #666666">0.0</span>
   <span style="color: #008000; font-weight: bold">for</span> batch_idx, (data, target) <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">enumerate</span>(train_loader):
       data, target <span style="color: #666666">=</span> data<span style="color: #666666">.</span>to(device), target<span style="color: #666666">.</span>to(device)
       optimizer<span style="color: #666666">.</span>zero_grad()
       outputs <span style="color: #666666">=</span> model(data)
       loss <span style="color: #666666">=</span> criterion(outputs, target)
       loss<span style="color: #666666">.</span>backward()
       optimizer<span style="color: #666666">.</span>step()
       running_loss <span style="color: #666666">+=</span> loss<span style="color: #666666">.</span>item()

   <span style="color: #008000">print</span>(<span style="color: #BA2121">f&#39;Epoch [</span><span style="color: #BB6688; font-weight: bold">{</span>epoch<span style="color: #666666">+1</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">/</span><span style="color: #BB6688; font-weight: bold">{</span>num_epochs<span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">], Loss: </span><span style="color: #BB6688; font-weight: bold">{</span>running_loss<span style="color: #666666">/</span><span style="color: #008000">len</span>(train_loader)<span style="color: #BB6688; font-weight: bold">:</span><span style="color: #BA2121">.4f</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&#39;</span>)

<span style="color: #408080; font-style: italic"># Testing the model</span>
model<span style="color: #666666">.</span>eval()
correct <span style="color: #666666">=</span> <span style="color: #666666">0</span>
total <span style="color: #666666">=</span> <span style="color: #666666">0</span>
<span style="color: #008000; font-weight: bold">with</span> torch<span style="color: #666666">.</span>no_grad():
   <span style="color: #008000; font-weight: bold">for</span> data, target <span style="color: #AA22FF; font-weight: bold">in</span> test_loader:
       data, target <span style="color: #666666">=</span> data<span style="color: #666666">.</span>to(device), target<span style="color: #666666">.</span>to(device)
       outputs <span style="color: #666666">=</span> model(data)
       _, predicted <span style="color: #666666">=</span> torch<span style="color: #666666">.</span>max(outputs<span style="color: #666666">.</span>data, <span style="color: #666666">1</span>)
       total <span style="color: #666666">+=</span> target<span style="color: #666666">.</span>size(<span style="color: #666666">0</span>)
       correct <span style="color: #666666">+=</span> (predicted <span style="color: #666666">==</span> target)<span style="color: #666666">.</span>sum()<span style="color: #666666">.</span>item()

<span style="color: #008000">print</span>(<span style="color: #BA2121">f&#39;Test Accuracy: </span><span style="color: #BB6688; font-weight: bold">{</span><span style="color: #666666">100</span> <span style="color: #666666">*</span> correct <span style="color: #666666">/</span> total<span style="color: #BB6688; font-weight: bold">:</span><span style="color: #BA2121">.2f</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">%&#39;</span>)
</pre>
</div>
      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="output_subarea output_stream output_stdout output_text">          
        </div>
      </div>
    </div>
  </div>
</div>


<p>
<!-- navigation buttons at the bottom of the page -->
<ul class="pagination">
<li><a href="._week45-bs057.html">&laquo;</a></li>
  <li><a href="._week45-bs000.html">1</a></li>
  <li><a href="">...</a></li>
  <li><a href="._week45-bs050.html">51</a></li>
  <li><a href="._week45-bs051.html">52</a></li>
  <li><a href="._week45-bs052.html">53</a></li>
  <li><a href="._week45-bs053.html">54</a></li>
  <li><a href="._week45-bs054.html">55</a></li>
  <li><a href="._week45-bs055.html">56</a></li>
  <li><a href="._week45-bs056.html">57</a></li>
  <li><a href="._week45-bs057.html">58</a></li>
  <li class="active"><a href="._week45-bs058.html">59</a></li>
</ul>
<!-- ------------------- end of main content --------------- -->
</div>  <!-- end container -->
<!-- include javascript, jQuery *first* -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
<!-- Bootstrap footer
<footer>
<a href="https://..."><img width="250" align=right src="https://..."></a>
</footer>
-->
<center style="font-size:80%">
<!-- copyright only on the titlepage -->
</center>
</body>
</html>

